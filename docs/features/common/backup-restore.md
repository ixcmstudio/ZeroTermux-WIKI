# ZeroTermux 容器备份/恢复教程

ZeroTermux支持对容器的备份与恢复教程,允许你在需要时对**当前**容器进行备份.本教程将指导你创建备份.


## 1. 前记

ZeroTermux支持两种备份的方式,在下文都有描述.


## 2. ZeroTermux默认备份

可在左侧边栏的`常用功能 > 备份/恢复`中找到.

### 备份

此处你可以看到有`tar.gz`,`tar.bz2`,`tar.xz`等压缩选项.可以按以下标准来选择你需要的格式:

| 格式          | gzip(tar.gz) | bzip2(tar.bz2) | xz(tar.xz) |
| ------------- | ------------ | -------------- | ---------- |
| 压缩/解压速度 | 优           | 良             | 差         |
| 压缩后体积    | 还说得过去   | 彳亍           | 很彳亍     |
| 兼容性        | 好           | 好             | 好         |

一般推荐使用`tar.gz`格式,如果对体积有特殊要求可以使用`tar.xz`.
任选一个之后,ZeroTermux会为你以你选择的格式进行备份,请保持ZeroTermux在前台并且保持设备不休眠.

> [!NOTE]
>
> 基于设备的性能强劲♂与否. 有时输出会停下或放缓,这是因为设备正在压缩较大的文件(例如`libLLVM.so`),请坐和放宽.

备份完成后会输出备份文件的地点,一般存在`/sdcard/xinhao/data`目录下(手机自带文件管理器的`内部存储/xinhao/data`下,其中内部存储的说辞可能因为厂商不同,叫法也不同).

### 恢复

> [!IMPORTANT]
>
> 如从[下载站](https://d.icdown.club/)或别的第三方平台下载来的数据包,请确保他们是给ZeroTermux使用的,具体信息请询问包原作者.
>
> 数据包应该放置在`/sdcard/xinhao/data`下

恢复环境会以以下方式进行展示:

![1](https://com.icdown.club/p/dontknowhy/wiki-assets/1.jpg)

其中我们需要特别关注的是`数据包名称`,如你有**十分甚至九分多**的数据包,请依赖于包名称查找而不是自己猜.

点击需要的数据包之后会被要求取一个新的系统盘名称,该名称会用在[容器切换](./container-switching.md)的容器名称中,请取一个对你阅读友好且方便记忆的名字,例如:`Debian GNU/Linux forky/sid`或者`Kali Linux`而不是`114514`,`ManILoveCerber`等无意义词语.

输入并确认恢复之后会进行恢复流程,期间会输出恢复出来的文件,完成之后将会输出:

````
系统恢复完成,请在切换系统, 切换你的系统
````

 此时你可以按照[容器切换](./container-switching.md)流程来进行切换.

## 2. termux-backup备份

ZeroTermux还支持另一种备份方式,也就是Termux原有的`termux-backup`指令.

> [!NOTE]
>
> 最新版ZeroTermux已经包含了此工具,如果没有请通过下面命令安装`termux-tools`.
>
> ```bash
> pkg install termux-tools
> ```

> [!NOTE]
>
> 此工具建议知道linux(准确来说是GNU/Linux)基本操作的用户使用.

> [!WARNING]
>
> 此工具**不会**备份你的**家目录**,如果你需要家目录的文件/不知道什么是家目录的话**请不要使用**.

### 备份

以下是其完整使用方法:

```
Usage: termux-backup [options] [output file]

用于备份 Termux 安装目录 ($PREFIX) 的脚本。

注意：该脚本不会备份你的 home 目录。

选项:
  -h, --help             显示此帮助信息
  -f, --force            强制执行写入操作
  --ignore-read-failure  忽略读取权限错误

备份说明:
  备份以 TAR 归档格式执行。
  压缩格式由输出文件扩展名决定。
  如果文件名为 '-'，则 tar 包将写入标准输出且不压缩。
```

一般而言,你可以用`termux-backup`加上输出的文件名来备份.例如:

```bash
termux-backup ~/storage/shared/xinhao/data/backup.tar.gz
```

上面的指令会将你的`$PREFIX`备份到`/sdcard/xinhao/data/backup.tar.gz`,但是不同于ZeroTermux自带的备份,你可以使用自行安装的压缩工具,以下是`termux-backup`所调用的归档工具`tar`的1.35版所支持的工具(有些包默认不会安装,需自行解决).

| 特性         | gzip (.gz)   | bzip2 (.bz2) | xz (.xz)        | lzip (.lz)    | lzma (.lzma)  | lzop (.lzo)     | zstd (.zst)         |
| :----------- | :----------- | :----------- | :-------------- | :------------ | :------------ | :-------------- | :------------------ |
| **压缩速度** | 非常快       | 慢           | **非常慢**      | 非常慢        | 非常慢        | **极快 (冠军)** | **极快 (媲美gzip)** |
| **解压速度** | 非常快       | 中等         | 快              | 快            | 快            | **极快 (冠军)** | **极快 (超越gzip)** |
| **压缩体积** | 较大         | 中等         | **极小 (冠军)** | 极小 (类似xz) | 极小 (类似xz) | 很大 (最差)     | 小 (接近xz)         |
| **CPU 占用** | 低           | 高           | **非常高**      | 高            | 高            | **极低**        | 低-中 (可调节)      |
| **兼容性**   | **无处不在** | 很好         | 好 (主流系统)   | 较差          | 较差          | 一般            | **好 (迅速普及)**   |
| **核心优势** | 兼容性，速度 | (已过时)     | **极致压缩率**  | 错误恢复      | (xz前身)      | **极致速度**    | **最佳平衡**        |

如果你挑好了用什么之后,你可以把上文的`.gz`替换成表格中你中意的压缩算法的后缀(例如选用zstd就使用`.zst`),以下是使用zstd压缩算法进行压缩保存的指令示范:

```bash
termux-backup ~/storage/shared/xinhao/data/backup.tar.zst
```

> [!IMPORTANT]
>
> 备份期间工具并不会输出太多内容,但如果无十分特殊的情况,你都应该默认他正在工作.
>
> 备份期间请将ZeroTermux保留在前台,且保持设备不休眠.
>
> 备份期间可能会卡住很长一段时间,具体多长取决于~~天公作不作美~~你`$PREFIX`资料的大小以及设备的性能.

当程序退出后(例如输出`Backing up installed packages...`过了一段时间后又输出了类似于`~ $`的内容),你就可以在你所指定的位置看见备份的文件(例如上文备份出来的`backup.tar.gz`).

### 恢复

> [!CAUTION]
>
> **数据无价,谨慎操作**

与`termux-backup`**配套**的是`termux-restore`程序(注意我给**配套**两字加上了粗体,请不要忽略这个可爱的**粗体**,他出现在这肯定是有原因的).

以下是其全部用法:

```
Usage: termux-restore [input file]

用于从指定的 TAR 归档文件恢复 Termux 安装目录 ($PREFIX) 的脚本。

说明:
  该脚本期望备份文件由 'termux-backup' 创建。
  恢复过程将删除 $PREFIX 目录中不存在于指定备份文件中的所有文件。
  请谨慎操作！

注意事项:
  如果输入文件指定为 '-'，则通过标准输入提供备份内容。
  请注意，通过管道传输的 TAR 归档文件必须是未压缩的。
```

一般来说,你可以通过使用`termux-restore`加上备份文件的路径来进行恢复.例如:

```bash
termux-restore ~/storage/shared/xinhao/data/backup.tar.gz
```

> [!CAUTION]
>
> **数据无价,谨慎操作**
>
> 该程序会把你`$PREFIX`文件夹**不经过询问**就抹的**一干二净**,请**千万,千万要确保你的`$PREFIX`没有你需要的内容**

在经过一阵*别样的恢复包大战*后,他会默默退出,此时你需要输入:

```
exit
```

并回车来退出ZeroTermux.再次打开时你的恢复包便正式恢复完成.
